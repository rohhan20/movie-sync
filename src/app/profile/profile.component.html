<div class="profile-container" *ngIf="user$ | async as user">
  <mat-card class="profile-card">
    <mat-card-header>
      <mat-card-title>{{ user.displayName }}</mat-card-title>
      <mat-card-subtitle>{{ user.email }}</mat-card-subtitle>
    </mat-card-header>
  </mat-card>

  <mat-card class="watched-list-card">
    <mat-card-header>
      <mat-card-title>My Watched List</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field class="search-field" appearance="fill">
        <mat-label>Add a movie to your watched list</mat-label>
        <input type="text" matInput [formControl]="searchControl" [matAutocomplete]="auto">
        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayMovie" (optionSelected)="addMovieToWatched($event.option.value)">
          <mat-option *ngFor="let movie of filteredMovies$ | async" [value]="movie">
            {{ movie.title }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <mat-list *ngIf="watchedMovies$ | async as watchedMovies">
        <mat-list-item *ngFor="let movie of watchedMovies">
          <span matListItemTitle>{{ movie.title }}</span>
          <span matListItemLine>{{ movie.description }}</span>
          <button mat-icon-button (click)="removeMovieFromWatched(movie.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-list-item>
      </mat-list>
    </mat-card-content>
  </mat-card>

  <mat-card class="recommendations-card" *ngIf="(recommendations$ | async)?.length">
    <mat-card-header>
      <mat-card-title>Personalized Recommendations</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div>
        <mat-form-field>
          <mat-label>Genre</mat-label>
          <mat-select [(ngModel)]="selectedGenre" (selectionChange)="applyFilters()">
            <mat-option value="">All</mat-option>
            <mat-option *ngFor="let genre of genres" [value]="genre">{{ genre }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-label>Year</mat-label>
        <mat-slider min="1990" max="2024" step="1">
          <input matSliderThumb [(ngModel)]="selectedYear" (input)="applyFilters()">
        </mat-slider>

        <mat-label>Rating</mat-label>
        <mat-slider min="1" max="10" step="0.1">
          <input matSliderThumb [(ngModel)]="selectedRating" (input)="applyFilters()">
        </mat-slider>
      </div>
      <mat-grid-list cols="3" rowHeight="350px" gutterSize="16px">
        <mat-grid-tile *ngFor="let movie of recommendations$ | async">
          <mat-card class="movie-card">
            <img mat-card-image [src]="movie.posterUrl" [alt]="movie.title">
            <mat-card-content>
              <mat-card-title>{{ movie.title }}</mat-card-title>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
      </mat-grid-list>
    </mat-card-content>
  </mat-card>
</div>
