<div class="profile-container" *ngIf="user$ | async as user">
  <div class="profile-header">
    <h1>{{ user.displayName }}'s Profile</h1>
    <p>{{ user.email }}</p>
  </div>

  <div class="profile-content">
    <div class="watched-list-container">
      <mat-card>
        <mat-card-header>
          <mat-card-title>My Watched List</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-list *ngIf="watchedMovies$ | async as watchedMovies; else noWatchedMovies">
            <mat-list-item *ngFor="let movie of watchedMovies">
              <img matListItemAvatar [src]="'https://image.tmdb.org/t/p/w92' + movie.poster_path" alt="{{ movie.title }}">
              <div matListItemTitle>{{ movie.title }}</div>
              <div matListItemLine>{{ movie.release_date | date:'yyyy' }}</div>
              <button mat-icon-button (click)="removeMovieFromWatched(movie.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-list-item>
          </mat-list>
          <ng-template #noWatchedMovies>
            <p class="empty-list-message">You haven't added any movies to your watched list yet.</p>
          </ng-template>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="recommendations-container">
      <h2>Recommended for You</h2>
      <div class="filter-controls">
        <mat-form-field appearance="outline">
          <mat-label>Genre</mat-label>
          <mat-select [(ngModel)]="selectedGenre" (selectionChange)="applyFilters()">
            <mat-option [value]="null">All Genres</mat-option>
            <mat-option *ngFor="let genre of genres" [value]="genre.id">{{ genre.name }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Year</mat-label>
          <input matInput type="number" [(ngModel)]="selectedYear" (keyup.enter)="applyFilters()">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Rating</mat-label>
          <input matInput type="number" [(ngModel)]="selectedRating" (keyup.enter)="applyFilters()">
        </mat-form-field>
      </div>
      <mat-grid-list cols="3" rowHeight="400px" gutterSize="24px" *ngIf="recommendations$ | async as recommendations; else loading">
        <mat-grid-tile *ngFor="let movie of recommendations">
          <app-movie-card [movie]="movie"></app-movie-card>
        </mat-grid-tile>
      </mat-grid-list>
      <ng-template #loading>
        <div class="loading-spinner">
          <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
        </div>
      </ng-template>
    </div>
  </div>
</div>
